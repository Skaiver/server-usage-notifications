import os 
import psutil                                               
import subprocess                                               

def notify():                                                       # notify via pushover                                           msg='System: $HOSTNAME@$(date)\n\nCPU Usage: ' + str(cpu_usage) + '\nRAM Usage: ' + str(ram_usage) + '\n\nEND'                   cmd="/bin/bash -c 'source ~/bin/cli_app.sh && push_to_mobile \"system-usage\" \"System: $HOSTNAME@$(date)\n\nLimited was reached!\nCPU Usage: "+str(cpu_usage)+" \nRAM Usage: "+str(ram_usage)+"\n\nEND\"'"              
    result = subprocess.run(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    output = result
    print(output)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # CPU                                                                                                                                                                                                                    ## Getting loadover15 minutes                                                                                                                                                                                            load1, load5, load15 = psutil.getloadavg()                                                                                                                                                                                                                                                                                                                                                                                                        cpu_usage = (load15/os.cpu_count()) * 100                                                                                                                                                                                                                                                                                                                                                                                                         print("The CPU usage is : ", cpu_usage)                                                                                                                                                                                                                                                                                                                                                                                                           # RAM                                                                                                                                                                                                                    ram_usage = psutil.virtual_memory()[2]                                                                                                                                                                                   ## Getting % usage of virtual_memory ( 3rd field)                                                                                                                                                                        print('RAM memory % used:', ram_usage)                                                                                                                                                                                   ## Getting usage of virtual_memory in GB ( 4th field)                                                                                                                                                                    #print('RAM Used (GB):', psutil.virtual_memory()[3]/1000000000)                                                                                                                                                                                                                                                                                                                                                                                   if ram_usage >= 80 or cpu_usage >= 80:                                                                                                                                                                                     notify() 
